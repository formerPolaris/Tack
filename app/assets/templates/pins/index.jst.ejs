<% pins.each(function (pin) { %>
  <div class="pin-panel-container">
    <div class="pin-panel">
<% console.log(pins) %>
      <img class="mini-avatar" src="<%= pin.get('user').escape('avatar_url') %>"></img>

      <span class="author-note">
        <strong><%= pin.escape("name").slice(0, 15) %></strong>
        <br>
        <%= pin.get('user').escape('name').slice(0, 15) || pin.get('user').escape('email').slice(0, 15) %>
      </span>

      <img class="img-pin" src="<%= pin.escape("image_url") %>" width="100%"></img>

    </div>
  </div>
<% }); %>


<script type="text/javascript">
  var wall = new freewall(".panel-box");
  wall.reset({
    selector: '.pin-panel-container',
    animate: true,
    cellW: 236,
    cellH: 'auto',
    onResize: function() {
      wall.fitWidth();
    }
  });

  var images = wall.container.find('.pin-panel-container');
  var length = images.length;
  images.css({visibility: 'hidden'});
  images.find('img').load(function() {
    -- length;
    if (!length) {
      setTimeout(function() {
        images.css({visibility: 'visible'});
        wall.fitWidth();
      }, 505);
    }
  });
</script>